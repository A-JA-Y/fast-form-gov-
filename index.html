<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GovForms — Auto Document Formatter</title>

<style>
body{font-family:Arial;margin:0;background:#f3f6fb}
header{background:#0f4c81;color:#fff;padding:15px;text-align:center;font-weight:bold}
.wrap{max-width:900px;margin:20px auto;padding:20px}
.card{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
label{display:block;margin-top:10px;font-weight:bold;font-size:13px}
input,select,button{width:100%;padding:8px;margin-top:5px}
button{cursor:pointer;background:#0f4c81;color:#fff;border:none;border-radius:6px}
.status{margin-top:10px;font-weight:bold}
</style>
</head>

<body>

<header>GovForms — Auto Document Formatter</header>

<div class="wrap">

<div class="card">
<label>Select Template</label>
<select id="template">
<option value="">-- Select --</option>
<option value="ssc">SSC (100x120)</option>
<option value="railway">Railway (200x230)</option>
<option value="bank">Bank (140x160)</option>
<option value="bpsc">BPSC (150x180)</option>
<option value="custom">Custom</option>
</select>

<div id="customBox" style="display:none">
<label>Width</label>
<input type="number" id="customW" value="100">
<label>Height</label>
<input type="number" id="customH" value="120">
</div>

<label>Photo</label>
<input type="file" id="photoFile" accept="image/*">

<label>Signature</label>
<input type="file" id="signFile" accept="image/*">

<label>ID (optional)</label>
<input type="file" id="idFile">

<button id="processBtn">Process & Download Files</button>
<div class="status" id="status">Ready</div>
</div>

</div>

<script>

const templates = {
ssc:{photo:{w:100,h:120,format:'jpeg'},sign:{w:140,h:60,format:'png'}},
railway:{photo:{w:200,h:230,format:'png'},sign:{w:150,h:50,format:'png'}},
bank:{photo:{w:140,h:160,format:'jpeg'},sign:{w:120,h:60,format:'jpeg'}},
bpsc:{photo:{w:150,h:180,format:'png'},sign:{w:120,h:60,format:'png'}}
};

const templateSel = document.getElementById("template");
const customBox = document.getElementById("customBox");
const customW = document.getElementById("customW");
const customH = document.getElementById("customH");
const photoFile = document.getElementById("photoFile");
const signFile = document.getElementById("signFile");
const idFile = document.getElementById("idFile");
const processBtn = document.getElementById("processBtn");
const statusEl = document.getElementById("status");

templateSel.addEventListener("change",()=>{
customBox.style.display = templateSel.value==="custom"?"block":"none";
});

function status(text,color="green"){
statusEl.style.color=color;
statusEl.innerText=text;
}

function downloadFile(file){
const url = URL.createObjectURL(file);
const a = document.createElement("a");
a.href=url;
a.download=file.name;
document.body.appendChild(a);
a.click();
a.remove();
URL.revokeObjectURL(url);
}

async function processImage(file,targetW,targetH,format){

const dataUrl = await new Promise(res=>{
const r=new FileReader();
r.onload=e=>res(e.target.result);
r.readAsDataURL(file);
});

const img = await new Promise(res=>{
const i=new Image();
i.onload=()=>res(i);
i.src=dataUrl;
});

const canvas=document.createElement("canvas");
canvas.width=targetW;
canvas.height=targetH;
const ctx=canvas.getContext("2d");

ctx.fillStyle="#fff";
ctx.fillRect(0,0,targetW,targetH);

/* CROP MODE (NO DISTORTION) */
const scale=Math.max(targetW/img.naturalWidth,targetH/img.naturalHeight);
const newW=img.naturalWidth*scale;
const newH=img.naturalHeight*scale;
const dx=(targetW-newW)/2;
const dy=(targetH-newH)/2;

ctx.drawImage(img,dx,dy,newW,newH);

const mime=format==="png"?"image/png":"image/jpeg";
const blob=await new Promise(res=>canvas.toBlob(res,mime,0.9));
const ext=format==="png"?"png":"jpg";
return new File([blob],`image_${targetW}x${targetH}.${ext}`,{type:mime});
}

processBtn.addEventListener("click",async()=>{

try{

if(!templateSel.value){
status("Select template","crimson");
return;
}

if(!photoFile.files[0] || !signFile.files[0]){
status("Upload photo & signature","crimson");
return;
}

let photoSpec,signSpec;

if(templateSel.value==="custom"){
const w=parseInt(customW.value);
const h=parseInt(customH.value);
photoSpec={w,h,format:"jpeg"};
signSpec={w:Math.round(w*0.6),h:Math.round(h*0.3),format:"png"};
}else{
photoSpec={...templates[templateSel.value].photo};
signSpec={...templates[templateSel.value].sign};
}

status("Processing...","blue");

const processedPhoto=await processImage(photoFile.files[0],photoSpec.w,photoSpec.h,photoSpec.format);
const processedSign=await processImage(signFile.files[0],signSpec.w,signSpec.h,signSpec.format);

downloadFile(processedPhoto);
downloadFile(processedSign);

if(idFile.files[0]){
downloadFile(idFile.files[0]);
}

status("Files downloaded successfully");

}catch(err){
console.error(err);
status("Error: "+err.message,"crimson");
}

});

</script>

</body>
</html>
